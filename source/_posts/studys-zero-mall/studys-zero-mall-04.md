---
title: Flutterç”µå•†é¡¹ç›®å­¦ä¹ ç¬”è®° 04-å®Œå–„æˆ‘çš„è®¢å•é¡µé¢æŸ¥è¯¢æ¥å£
date: 2024-05-17 00:32:46
updated:
tags:
  - "æ–‡ç« "
  - "å­¦ä¹ ç¬”è®°"
categories: 
  - "å­¦ä¹ ç¬”è®°"
  - "Flutterç”µå•†é¡¹ç›®"
description: "æœ€è¿‘å¼€å§‹å­¦ä¹ ä¸€ä¸ªå¼€æºçš„ç”µå•†é¡¹ç›®ï¼Œæœ€å¼€å§‹åªæ˜¯æƒ³å­¦ä¹ flutterï¼Œä½†æ˜¯ä¸ºäº†è·‘èµ·flutterçš„ç”µå•†é¡¹ç›®ï¼Œè¢«è¿«å­¦ä¹ äº†å¾ˆå¤šçŸ¥è¯†ã€‚
å…¶ä¸­åŒ…æ‹¬Flutteræ¡†æ¶ï¼Œgolangè¯­è¨€å¼€å‘çš„åç«¯ï¼Œé‡‡ç”¨go-zeroå¾®æœåŠ¡æ¡†æ¶ï¼Œåˆè¦å­¦ä¹ gPRC, etcdç­‰é¡¹ç›®ã€‚
æœ¬æ¥ä»¥ä¸ºå®Œäº‹äº†ï¼Œç»“æœåå°ç®¡ç†é¡µé¢æ˜¯reactå†™çš„ï¼Œè¿˜ç”¨äº†ant-design-proã€‚"
cover: https://jsd.012700.xyz/gh/jerryc127/CDN@latest/cover/default_bg.png
---

## ä»‹ç»
### æ¦‚è¦
æœ¬ç« èŠ‚å¯¹ç§»åŠ¨ç«¯APPä¸­ï¼Œå®Œå–„æˆ‘çš„è®¢å•åŠŸèƒ½ã€‚
è¯¥é¡µé¢ä½äºç§»åŠ¨ç«¯APP {% label 'æˆ‘çš„ > å…¨éƒ¨è®¢å•' blue %} ,æ”¹é€ å‰å·²ç»å®ŒæˆåŸºç¡€åˆ—è¡¨å±•ç¤ºçš„åŠŸèƒ½ï¼Œä½†æ˜¯"å¾…é€€è´§"ã€"å¾…æ”¯ä»˜"ç­‰ä¸åŒTabæ˜¾ç¤ºå®Œå…¨ç›¸åŒçš„æ•°æ®ã€‚
è¯¥ç« èŠ‚ä¸»è¦å†…å®¹æ˜¯å¯¹è¿™ä¸ªé¡µé¢è¿›è¡Œæ”¹é€ ï¼Œä½¿å¾—ä¸åŒTabéœ€è¦æ˜¾ç¤ºä¸åŒçš„æ•°æ®

## æ­£æ–‡
### ä¸åŒTabæ˜¾ç¤ºä¸åŒçš„æ•°æ®
#### æ¥å£æè¿°ä¸æ»¡è¶³å‰ç«¯ä½¿ç”¨
``` diff go-zero
type OrderListReq {
     Current int64 `path:"current,default=1"`
     PageSize int64 `path:"pageSize,default=5"`
-    Status int64 `path:"status"` // è®¢å•çŠ¶æ€ï¼š0->å¾…ä»˜æ¬¾ï¼›1->å¾…å‘è´§ï¼›2->å·²å‘è´§ï¼›3->å·²å®Œæˆï¼›4->å·²å…³é—­ï¼›5->æ— æ•ˆè®¢å•
+    Status []int64 `json:"status"` // è®¢å•çŠ¶æ€ï¼š0->å¾…ä»˜æ¬¾ï¼›1->å¾…å‘è´§ï¼›2->å·²å‘è´§ï¼›3->å·²å®Œæˆï¼›4->å·²å…³é—­ï¼›5->æ— æ•ˆè®¢å•
}

//æŒ‰çŠ¶æ€åˆ†é¡µè·å–ç”¨æˆ·è®¢å•åˆ—è¡¨
@handler OrderList
-    get /orderList/:status/:current (OrderListReq) returns (OrderListResp)
+    get /orderList/:current (OrderListReq) returns (OrderListResp)
```

"å…¨éƒ¨"é¡µé¢ä¸­åº”è¯¥åŒ…å«äº”ç§è®¢å•çŠ¶æ€çš„æ•°æ®ï¼Œè€Œæ¥å£ä¸­åªæœ‰ä¸€ä¸ªå­—æ®µï¼ŒæŒ‰ç…§æ”¹é€ å‰è®¾ç½®çš„æ¥å£è§„èŒƒéœ€è¦è¯·æ±‚åç«¯5æ¬¡ï¼›
æ”¹é€ æ–¹æ¡ˆï¼š
1. ä¿®æ”¹æ¥å£æè¿°ï¼Œå°†"status"æ›´æ”¹ä¸º"query type"ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´ä¼ é€’ï¼Œä½¿ç”¨æŸ¥è¯¢ç±»å‹ä¼ é€’ç»„åˆä¿¡æ¯
    - ä¼˜ç‚¹ï¼šæ”¹é€ ç®€å•
    - ç¼ºç‚¹ï¼š
        - ä¸ç¬¦åˆå‰åç«¯åˆ†ç¦»çš„æ€æƒ³
        - å¯èƒ½éœ€è¦åç«¯ç»´æŠ¤é¢å¤–çš„`Map<QueryType, Status[]>`
        - å¯èƒ½ä¼šå¯¼è‡´QueryTypeå’ŒStatusç å€¼å†²çª;

2. ä¿®æ”¹æ¥å£æè¿°ï¼Œä½¿ç”¨"status"ä¼ é€’ä½æ©ç ä¿¡æ¯
    - å®ç°æ–¹æ¡ˆï¼š
        - Cè¯­è¨€ä¸­ä½åŸŸï¼ˆBit-fieldsï¼‰çš„é«˜çº§ç©æ³•ï¼Œ8ä¸ªæ¡ˆä¾‹ä»£ç å‘Šè¯‰ä½ æ€ä¹ˆç©: https://zhuanlan.zhihu.com/p/636551863
        - å¥‡æ€ªçš„çŸ¥è¯†â€”â€”ä½æ©ç : https://zhuanlan.zhihu.com/p/352025616
    - ä¼˜ç‚¹ï¼šæ¥å£æ¸…æ™°
    - ç¼ºç‚¹ï¼šæœ‰ä¸€å®šé—¨æ§›ï¼Œéœ€è¦å¼€å‘äº†è§£ä½æ“ä½œï¼Œéœ€è¦ä¿®æ”¹å­—æ®µåå­—ï¼Œå‡å°‘è¯¯è§£

3. ä¿®æ”¹æ¥å£æè¿°ï¼Œä½¿ç”¨"status[]"ä¼ é€’æ•°æ®ä¿¡æ¯
    - ä¼˜ç‚¹: æ¥å£æ¸…æ™°ï¼Œä¸éœ€è¦ä¿®æ”¹å­—æ®µåï¼Œä¸éœ€è¦å¢åŠ é¢å¤–çš„æ¦‚å¿µ
    - ç¼ºç‚¹: éœ€è¦ä½¿ç”¨æ•°ç»„æ¥ä¼ é€’ä¿¡æ¯

æœ€åæˆ‘é€‰ç”¨äº†ç¬¬ä¸‰ç§æ–¹æ¡ˆ

#### ä¿®æ”¹è¿‡ç¨‹
1. ä¿®æ”¹ api å’Œ proto æ–‡ä»¶
  - HTTPæ¥å£æ–‡ä»¶ `api/front/doc/api/order.api`
  - gRPCæ¥å£æ–‡ä»¶ `rpc/oms/oms.proto`
2. ä½¿ç”¨goctlç”Ÿæˆå¯¹åº”ä»£ç 
  - ç”ŸæˆHTTPæ¥å£å‘½ä»¤ `goctl api go -api ./api/front/doc/api/front.api -dir ./api/front/`
  - ç”ŸæˆgRPCæ¥å£å‘½ä»¤ `goctl rpc protoc rpc/oms/oms.proto --go_out=./rpc/oms/ --go-grpc_out=./rpc/oms/ --zrpc_out=./rpc/oms/ -m`
3. ä¿®å¤ä¸Šè¯‰å‘½ä»¤æ‰§è¡Œå®Œæ¯•åçš„é—®é¢˜
  - SQLæŸ¥è¯¢è¯­å¥

#### mysqlä¿®æ”¹
``` go
if len(in.Status) > 0 {
  where = where + fmt.Sprintf(" AND status in (%s)", func() string {
    s := ""
    for i, v := range in.Status {
      if i > 0 {
        s += ", "
      }
      s += fmt.Sprintf("%d", v)
    }
    return s
  }())
}
```
æœ‰ä¸€ç§å¤§é“è‡³ç®€çš„ç¾æ„ŸğŸ˜“
`in.Status`æ˜¯`int[]`æ•°æ®ï¼Œè™½ç„¶ä½¿ç”¨å®¢æˆ·ç«¯è¾“å…¥æ•°æ®è¿›è¡Œæ‹¼æ¥ï¼Œä½†å·²ç»ä¿è¯`in.Status`æ˜¯æ•´å‹æ•°æ®ï¼Œå› æ­¤ä¸å­˜åœ¨SQLæ³¨å…¥çš„é£é™©

#### å…¶ä»–äº‹é¡¹
- å…ˆä¿è¯gitä»“åº“æ•´æ´ï¼Œç„¶åæ‰§è¡ŒgoctlæŒ‡ä»¤ï¼Œæ‰§è¡Œå®ŒæŸ¥çœ‹git diffï¼Œè¿™æ ·å°±çŸ¥é“ä»£ç ç”Ÿæˆå·¥å…·æ˜¯å¦æ‰§è¡Œæ­£ç¡®äº†ï¼›
- goctlå®é™…ä¸Šæœ‰ç”Ÿæˆdart modelçš„æŒ‡ä»¤ï¼Œgoctl dart api *ï¼Œä½†æ˜¯è¿™ä¸ªé¡¹ç›®æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼›
- ä¹‹å‰åªæŠŠ`status`æ”¹æˆ`int[]` å¿˜è®°æŠŠåé¢çš„`path:"status"`æ”¹æˆ`json:"status"`ï¼Œè¿™ä¸ªé—®é¢˜æ’æŸ¥äº†å¾ˆé•¿æ—¶é—´ï¼›
